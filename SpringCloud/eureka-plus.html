<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Eureka从0到1完整实践(下) —— 基于Eureka实现高可用的服务治理方案 | Joey Studio</title>
    <meta name="description" content="Joey Studio">
    <link rel="icon" href="/icon.png">
    
    <link rel="preload" href="/assets/css/0.styles.fb6ef450.css" as="style"><link rel="preload" href="/assets/js/app.6496ed3f.js" as="script"><link rel="preload" href="/assets/js/34.503ff2e4.js" as="script"><link rel="prefetch" href="/assets/js/2.154dcc5e.js"><link rel="prefetch" href="/assets/js/3.2d1485e9.js"><link rel="prefetch" href="/assets/js/4.bff3c410.js"><link rel="prefetch" href="/assets/js/5.dae9ed13.js"><link rel="prefetch" href="/assets/js/6.0e78168f.js"><link rel="prefetch" href="/assets/js/7.080d07e2.js"><link rel="prefetch" href="/assets/js/8.b51527e8.js"><link rel="prefetch" href="/assets/js/9.47e0dfdd.js"><link rel="prefetch" href="/assets/js/10.df869b81.js"><link rel="prefetch" href="/assets/js/11.ca769e48.js"><link rel="prefetch" href="/assets/js/12.054daf01.js"><link rel="prefetch" href="/assets/js/13.a59e5c03.js"><link rel="prefetch" href="/assets/js/14.0b0c8a1d.js"><link rel="prefetch" href="/assets/js/15.a62e713d.js"><link rel="prefetch" href="/assets/js/16.1f5c82f7.js"><link rel="prefetch" href="/assets/js/17.12cc41fd.js"><link rel="prefetch" href="/assets/js/18.9a24a91a.js"><link rel="prefetch" href="/assets/js/19.f6abe518.js"><link rel="prefetch" href="/assets/js/20.e65b6931.js"><link rel="prefetch" href="/assets/js/21.0b676c70.js"><link rel="prefetch" href="/assets/js/22.439a1331.js"><link rel="prefetch" href="/assets/js/23.ba536dc8.js"><link rel="prefetch" href="/assets/js/24.c320b32b.js"><link rel="prefetch" href="/assets/js/25.3e421fe3.js"><link rel="prefetch" href="/assets/js/26.2231c0ca.js"><link rel="prefetch" href="/assets/js/27.bcc817c1.js"><link rel="prefetch" href="/assets/js/28.c2c3d444.js"><link rel="prefetch" href="/assets/js/29.2ead0a19.js"><link rel="prefetch" href="/assets/js/30.1255fe73.js"><link rel="prefetch" href="/assets/js/31.560e43a1.js"><link rel="prefetch" href="/assets/js/32.4763ce13.js"><link rel="prefetch" href="/assets/js/33.f65b93ac.js"><link rel="prefetch" href="/assets/js/35.abff669d.js"><link rel="prefetch" href="/assets/js/36.aa126b1a.js"><link rel="prefetch" href="/assets/js/37.92bebcb1.js"><link rel="prefetch" href="/assets/js/38.c3c64b7f.js"><link rel="prefetch" href="/assets/js/39.d86c8f5e.js"><link rel="prefetch" href="/assets/js/40.17162130.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fb6ef450.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Joey Studio</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/Web/" class="nav-link">工具</a></div><div class="nav-item"><a href="/JVM/" class="nav-link">JVM</a></div><div class="nav-item"><a href="/SpringCloud/" class="nav-link router-link-active">微服务</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div><div class="nav-item"><a href="https://github.com/slowside45" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><a href="/Web/" class="nav-link">工具</a></div><div class="nav-item"><a href="/JVM/" class="nav-link">JVM</a></div><div class="nav-item"><a href="/SpringCloud/" class="nav-link router-link-active">微服务</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于我</a></div><div class="nav-item"><a href="https://github.com/slowside45" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/SpringCloud/eureka.html" class="sidebar-link">Eureka从0到1完整实践(上) —— 基于Eureka构建最简服务治理方案</a></li><li><a href="/SpringCloud/eureka-plus.html" class="active sidebar-link">Eureka从0到1完整实践(下) —— 基于Eureka实现高可用的服务治理方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SpringCloud/eureka-plus.html#前置条件" class="sidebar-link">前置条件</a></li><li class="sidebar-sub-header"><a href="/SpringCloud/eureka-plus.html#参考链接" class="sidebar-link">参考链接</a></li><li class="sidebar-sub-header"><a href="/SpringCloud/eureka-plus.html#什么是高可用？" class="sidebar-link">什么是高可用？</a></li><li class="sidebar-sub-header"><a href="/SpringCloud/eureka-plus.html#服务注册中心集群部署" class="sidebar-link">服务注册中心集群部署</a></li></ul></li></ul> </div> <div class="page"> <div class="content"><h1 id="eureka从0到1完整实践-下-——-基于eureka实现高可用的服务治理方案"><a href="#eureka从0到1完整实践-下-——-基于eureka实现高可用的服务治理方案" aria-hidden="true" class="header-anchor">#</a> Eureka从0到1完整实践(下) —— 基于Eureka实现高可用的服务治理方案</h1> <p>本项目全程使用Gradle完成构建，Gradle版本为5.4.1</p> <h2 id="前置条件"><a href="#前置条件" aria-hidden="true" class="header-anchor">#</a> 前置条件</h2> <ul><li>搭建基本的单点项目。<a href="https://slowside45.github.io/SpringCloud/eureka.html" target="_blank" rel="noopener noreferrer">Eureka从0到1完整实践(上) —— 基于Eureka构建最简服务治理方案<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <hr> <h2 id="参考链接"><a href="#参考链接" aria-hidden="true" class="header-anchor">#</a> 参考链接</h2> <ul><li><a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&mid=2651959728&idx=1&sn=933227840ec8cdc35d3a33ae3fe97ec5&chksm=bd2d046c8a5a8d7a13551124af36bedf68f7a6e31f6f32828678d2adb108b86b7e08c678f22f&scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">究竟啥才是互联网架构“高可用”<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> —— @58沈剑</li></ul> <p><strong>本篇文章，将记录使用Eureka完成服务层面的高可用设计。</strong></p> <hr> <h2 id="什么是高可用？"><a href="#什么是高可用？" aria-hidden="true" class="header-anchor">#</a> 什么是高可用？</h2> <blockquote><p>高可用HA（High Availability）是分布式系统架构设计中必须考虑的因素之一，它通常是指，通过设计减少系统不能提供服务的时间。</p></blockquote> <p>常见系统，一般通过<strong>冗余</strong>+<strong>自动故障转移</strong>来实现系统的高可用特性。</p> <ul><li>冗余： 同时多个系统可以同步对外提供服务。</li> <li>自动故障转移： 当一个系统出现故障时，流量能自动转移到正常运行的系统上。</li></ul> <hr> <h2 id="服务注册中心集群部署"><a href="#服务注册中心集群部署" aria-hidden="true" class="header-anchor">#</a> 服务注册中心集群部署</h2> <ul><li><p>创建application-server2.yml文件</p> <p><img src="/assets/img/image-20200409165535031.c33048a4.png" alt="image-20200409165535031"></p> <div class="language- extra-class"><pre class="language-text"><code>server:
  port: 8001
spring:
  application:
    name: eureka-server
  # Springboot应用启动参数
  profiles:
    active: server2
eureka:
  instance:
    # 该服务的主机名称
    hostname: eureka-center2
    # 服务失效时间，Eureka多长时间没收到服务的心跳操作，就剔除该服务，默认90秒
    lease-expiration-duration-in-seconds: 90
    # 表示eureka client发送心跳给server端的频率
    lease-renewal-interval-in-seconds: 30
  client:
    # 表示是否注册，默认为true
    register-with-eureka: true
    # 表示是否拉取，默认为true
    fetch-registry: true
    # 该注册中心将会被注册到8000端口上的另一个eureka服务注册中心，它们之间的数据将会共享。
    service-url:
      defaultZone: http://localhost:8000/eureka/
  server:
    # eureka server清理无效节点的时间间隔，默认60000毫秒，即60秒
    eviction-interval-timer-in-ms: 60000
    # 自我保护模式（缺省为打开）
    enable-self-preservation: true
</code></pre></div></li> <li><p>编辑应用启动选项</p></li></ul> <p><img src="/assets/img/image-20200409164557525.2aac1c85.png" alt="image-20200409164557525"></p> <p><img src="/assets/img/image-20200409165850980.03c26a10.png" alt="image-20200409165850980"></p> <p><img src="/assets/img/image-20200409170048402.92b866fe.png" alt="image-20200409170048402"></p> <ul><li><p>启动两个服务注册中心（不分先后）</p> <p>8000端口的服务注册中心1 已启动</p> <p><img src="/assets/img/image-20200409170149793.77068c27.png" alt="image-20200409170149793"></p> <p>8001端口的服务注册中心2 已启动</p> <p><img src="/assets/img/image-20200409170227534.dfc8d1a8.png" alt="image-20200409170227534"></p></li></ul> <p>期间，可能会出现这样的异常：</p> <p><img src="/assets/img/image-20200409170253807.11e2090f.png" alt="image-20200409170253807"></p> <p>这是由于服务启动时，它需要将自身注册到application.yml文件中指定的serverUrl所在的服务注册中心上，这时服务注册中心可能尚未完成启动，就会抛出这样的异常。由于eureka会定期向服务注册中心发送请求，当服务注册中心启动成功后，你将看到如下提示：</p> <p><img src="/assets/img/image-20200409170601960.f3cab972.png" alt="image-20200409170601960"></p> <p>这时，说明该服务已成功注册到服务中心。</p> <p>按照以上步骤，我们在8000端口和8001端口已经启动了两个基于eureka实现的服务注册中心，eureka自动为我们构建了管理页面，访问http://localhost:8000和http://localhost:8001即可查看。</p> <p><img src="/assets/img/image-20200409171127296.cc3f549f.png" alt="image-20200409171127296"></p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/SpringCloud/eureka.html" class="prev">
          Eureka从0到1完整实践(上) —— 基于Eureka构建最简服务治理方案
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/assets/js/34.503ff2e4.js" defer></script><script src="/assets/js/app.6496ed3f.js" defer></script>
  </body>
</html>
