(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{288:function(t,n,a){t.exports=a.p+"assets/img/image-20200408023948172.5c31196f.png"},289:function(t,n,a){t.exports=a.p+"assets/img/image-20200408024001457.4b67307b.png"},292:function(t,n,a){t.exports=a.p+"assets/img/image-20200408022556581.5767bec8.png"},293:function(t,n,a){t.exports=a.p+"assets/img/image-20200408022623423.1dcd90e0.png"},294:function(t,n,a){t.exports=a.p+"assets/img/image-20200408030454398.e9d9314b.png"},295:function(t,n,a){t.exports=a.p+"assets/img/image-20200408030509021.26e7f413.png"},296:function(t,n,a){t.exports=a.p+"assets/img/image-20200408023531899.dbe49bd3.png"},297:function(t,n,a){t.exports=a.p+"assets/img/image-20200408023628422.35a30c12.png"},298:function(t,n,a){t.exports=a.p+"assets/img/image-20200408030553573.11e06940.png"},299:function(t,n,a){t.exports=a.p+"assets/img/image-20200408024125758.82d5f721.png"},300:function(t,n,a){t.exports=a.p+"assets/img/image-20200408025000140.da2c671b.png"},301:function(t,n,a){t.exports=a.p+"assets/img/image-20200408024838595.a27c57b0.png"},302:function(t,n,a){t.exports=a.p+"assets/img/image-20200408030752728.6fea3fb3.png"},303:function(t,n,a){t.exports=a.p+"assets/img/image-20200408030801066.a42b1742.png"},304:function(t,n,a){t.exports=a.p+"assets/img/image-20200408031300013.a04db829.png"},305:function(t,n,a){t.exports=a.p+"assets/img/image-20200408030247853.7088f277.png"},306:function(t,n,a){t.exports=a.p+"assets/img/image-20200408030922721.57e5f81b.png"},307:function(t,n,a){t.exports=a.p+"assets/img/image-20200408031030626.5db48c44.png"},308:function(t,n,a){t.exports=a.p+"assets/img/image-20200408031211916.f0badd4c.png"},309:function(t,n,a){t.exports=a.p+"assets/img/image-20200408032803657.f83c2433.png"},310:function(t,n,a){t.exports=a.p+"assets/img/image-20200408033450383.50509743.png"},311:function(t,n,a){t.exports=a.p+"assets/img/image-20200408033632732.10ad69ee.png"},312:function(t,n,a){t.exports=a.p+"assets/img/image-20200408033558255.8790d991.png"},313:function(t,n,a){t.exports=a.p+"assets/img/image-20200408033642464.e36e086d.png"},318:function(t,n,a){"use strict";a.r(n);var s=[function(){var t=this.$createElement,n=this._self._c||t;return n("h1",{attrs:{id:"eureka从0到1完整实践-上-——-基于gradle构建的服务治理方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#eureka从0到1完整实践-上-——-基于gradle构建的服务治理方案","aria-hidden":"true"}},[this._v("#")]),this._v(" Eureka从0到1完整实践(上) —— 基于Gradle构建的服务治理方案")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"初识eureka——eureka的两种角色"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#初识eureka——eureka的两种角色","aria-hidden":"true"}},[this._v("#")]),this._v(" 初识Eureka——Eureka的两种角色")])},function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("ul",[a("li",[a("p",[t._v("Eureka Client")]),t._v(" "),a("p",[t._v("注册到Eureka Server的服务，可分为服务提供者(Service Provider)和服务消费者(Service Consumer)。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Service Provider")]),t._v(" "),a("p",[t._v("provider将完成三个任务：")]),t._v(" "),a("ol",[a("li",[t._v("注册：将自身注册到注册中心")]),t._v(" "),a("li",[t._v("续约：定期向注册中心发送心跳包")]),t._v(" "),a("li",[t._v("下线：当provider示例关闭时，将发送下线通知到注册中心")])])]),t._v(" "),a("li",[a("p",[t._v("Service Consumer")]),t._v(" "),a("ol",[a("li",[t._v("拉取服务列表：向注册中心获取服务信息。")]),t._v(" "),a("li",[t._v("服务调用：根据服务信息调用服务。")])])])]),t._v(" "),a("p",[t._v("值得注意的是，一个服务既可以作为服务提供者(Service Provider)将自身示例注册到Eureka Server，同时也可以作为服务消费者(Service Consumer)从Eureka Server拉取服务信息，完成服务消费。")])]),t._v(" "),a("li",[a("p",[t._v("Eureka Server")]),t._v(" "),a("p",[t._v("为其他服务提供托管能力的服务。它将具备以下能力：")]),t._v(" "),a("ol",[a("li",[t._v("自我保护：（可配置）默认将15分钟内心跳成功比例低于85%的服务信息进行保存，不再删除服务注册表中的数据（也就是不会注销任何微服务）。当网络故障恢复后，该Eureka Server节点会自动退出自我保护模式，以便其他服务重新连接后能同步数据。")]),t._v(" "),a("li",[t._v("定期清除：（可配置）默认每隔60秒，将默认90秒未发送心跳的服务从清单中移除。")])])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"_1-创建gradle父级容器项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建gradle父级容器项目","aria-hidden":"true"}},[this._v("#")]),this._v(" 1. 创建Gradle父级容器项目")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("img",{attrs:{src:a(292),alt:"image-20200408022556581"}})])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("img",{attrs:{src:a(293),alt:"image-20200408022623423"}})])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("img",{attrs:{src:a(294),alt:"image-20200408030454398"}})])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[this._v("![image-20200408023208279](../.vuepress/public/img/SpringCloud/image-20200408023208279.png"),n("img",{attrs:{src:a(295),alt:"image-20200408030509021"}})])},function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("ul",[a("li",[a("p",[t._v("build.gradle的文件内容")]),t._v(" "),a("div",{staticClass:"language-groovy extra-class"},[a("pre",{pre:!0,attrs:{class:"language-groovy"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 在module编译时自动执行")]),t._v("\nbuildscript "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ext "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("//定义一个变量，统一规定springboot的版本")]),t._v("\n        springBootVersion "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'1.5.10.RELEASE'")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    repositories "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        maven "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url "),a("span",{attrs:{class:"token string"}},[t._v("'http://maven.aliyun.com/nexus/content/groups/public/'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("jcenter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("mavenCentral")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("//Spring repo")]),t._v("\n        maven "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url "),a("span",{attrs:{class:"token string gstring"}},[t._v('"http://repo.spring.io/snapshot"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        maven "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url "),a("span",{attrs:{class:"token string gstring"}},[t._v('"http://repo.spring.io/milestone"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        maven "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url "),a("span",{attrs:{class:"token string gstring"}},[t._v('"http://repo.spring.io/release"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        maven "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url "),a("span",{attrs:{class:"token string"}},[t._v("'http://repo.spring.io/plugins-snapshot'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    dependencies "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{attrs:{class:"token comment"}},[t._v("//用来打包")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("classpath")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string gstring"}},[t._v('"org.springframework.boot:spring-boot-gradle-plugin:'),a("span",{attrs:{class:"token expression"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("springBootVersion"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nplugins "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    id "),a("span",{attrs:{class:"token string"}},[t._v("'java'")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nsourceCompatibility "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1.8")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("//设定当前所有的项目的配置")]),t._v("\nallprojects "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    group "),a("span",{attrs:{class:"token string"}},[t._v("'com.microve'")]),t._v("\n    version "),a("span",{attrs:{class:"token string"}},[t._v("'1.0-SNAPSHOT'")]),t._v("\n\n    ext "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        springCloudVersion "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Edgware.SR2'")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    repositories "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        maven "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url "),a("span",{attrs:{class:"token string"}},[t._v("'http://maven.aliyun.com/nexus/content/groups/public/'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("jcenter")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("mavenCentral")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("//Spring repo")]),t._v("\n        maven "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url "),a("span",{attrs:{class:"token string gstring"}},[t._v('"http://repo.spring.io/snapshot"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        maven "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url "),a("span",{attrs:{class:"token string gstring"}},[t._v('"http://repo.spring.io/milestone"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        maven "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url "),a("span",{attrs:{class:"token string gstring"}},[t._v('"http://repo.spring.io/release"')]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        maven "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url "),a("span",{attrs:{class:"token string"}},[t._v("'http://repo.spring.io/plugins-snapshot'")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("//设定当前模块的子项目中的配置")]),t._v("\nsubprojects "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    apply plugin"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'java'")]),t._v("\n    apply plugin"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'idea'")]),t._v("\n    apply plugin"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'spring-boot'")]),t._v("\n\n    dependencies "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("//使用springboot-web组件，但是排除tomcat组件")]),t._v("\n        compile "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'org.springframework.boot:spring-boot-starter-web'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            exclude module"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token string gstring"}},[t._v('"spring-boot-starter-tomcat"')]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("//使用undertow作为servlet容器")]),t._v("\n        compile "),a("span",{attrs:{class:"token string"}},[t._v("'org.springframework.boot:spring-boot-starter-undertow'")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("//使用健康检查组件")]),t._v("\n        compile "),a("span",{attrs:{class:"token string"}},[t._v("'org.springframework.boot:spring-boot-starter-actuator'")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("testCompile")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                group"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'junit'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'junit'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" version"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'4.12'")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    dependencyManagement "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        imports "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token comment"}},[t._v("//加上此配置后，如果需要引用springcloud的组件，就不需要再提供版本信息")]),t._v("\n            mavenBom "),a("span",{attrs:{class:"token string gstring"}},[t._v('"org.springframework.cloud:spring-cloud-dependencies:'),a("span",{attrs:{class:"token expression"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("springCloudVersion"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"（可选）2-配置本地gradle-home"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#（可选）2-配置本地gradle-home","aria-hidden":"true"}},[this._v("#")]),this._v(" （可选）2. 配置本地Gradle home")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("img",{attrs:{src:a(296),alt:"image-20200408023531899"}})])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("img",{attrs:{src:a(297),alt:"image-20200408023628422"}})])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"_3-构建eureka-server"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-构建eureka-server","aria-hidden":"true"}},[this._v("#")]),this._v(" 3. 构建Eureka-Server")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("img",{attrs:{src:a(288),alt:"image-20200408023948172"}}),n("img",{attrs:{src:a(289),alt:"image-20200408024001457"}})])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("img",{attrs:{src:a(298),alt:"image-20200408030553573"}})])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[n("img",{attrs:{src:a(299),alt:"image-20200408024125758"}})])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("ul",[s("li",[s("p",[t._v("build.gradle配置：")]),t._v(" "),s("p",[t._v("除了在父级项目中引入的依赖，还需单独引入作为Eureka-server的相关依赖。")]),t._v(" "),s("div",{staticClass:"language-groovy extra-class"},[s("pre",{pre:!0,attrs:{class:"language-groovy"}},[s("code",[t._v("dependencies "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    testCompile group"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'junit'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'junit'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" version"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'4.12'")]),t._v("\n    implementation "),s("span",{attrs:{class:"token string"}},[t._v("'org.springframework.cloud:spring-cloud-starter-eureka-server'")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("application.yml配置：")]),t._v(" "),s("p",[t._v("该项目的resource文件夹为默认配置文件夹，在该文件夹下创建application.yml文件。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server:\n  port: 8000\nspring:\n  application:\n    name: eureka-server\neureka:\n  instance:\n    // 该服务的主机名称\n    hostname: eureka-center-one\n    # 服务失效时间，Eureka多长时间没收到服务的心跳操作，就剔除该服务，默认90秒\n    lease-expiration-duration-in-seconds: 90\n    # 表示eureka client发送心跳给server端的频率\n    lease-renewal-interval-in-seconds: 30\n  client:\n    #表示不注册\n    register-with-eureka: false\n    #表示不拉取\n    fetch-registry: false\n    ## 如果不配置此url，将会启动在默认端口8761\n    service-url:\n      defaultZone: http://localhost:8000/eureka/\n  server:\n    # eureka server清理无效节点的时间间隔，默认60000毫秒，即60秒\n    eviction-interval-timer-in-ms: 60000\n    # 自我保护模式（缺省为打开）\n    enable-self-preservation: true\n")])])]),s("p",[t._v("关于为什么需要配置defaultZone属性，请参考这篇博客：")])]),t._v(" "),s("li",[s("p",[t._v("创建Starter类")]),t._v(" "),s("p",[s("img",{attrs:{src:a(300),alt:"image-20200408025000140"}})]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("package com.microve;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;\n\n/**\n * @author : Li Junyi\n * @Remark：\n * @Date 2020-04-05 03:37\n */\n@SpringBootApplication\n@EnableEurekaServer\npublic class EurekaCenterOneStarter {\n    public static void main(String[] args) {\n        SpringApplication.run(EurekaCenterOneStarter.class, args);\n    }\n}\n")])])])]),t._v(" "),s("li",[s("p",[t._v("启动注册中心：")]),t._v(" "),s("p",[t._v("启动成功，等待请求。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(301),alt:"image-20200408024838595"}})])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"_4-构建eureka-client-——-服务提供者"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-构建eureka-client-——-服务提供者","aria-hidden":"true"}},[this._v("#")]),this._v(" 4. 构建Eureka Client —— 服务提供者")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("ul",[s("li",[s("p",[t._v("创建子项目")]),t._v(" "),s("p",[s("img",{attrs:{src:a(288),alt:"image-20200408023948172"}})]),t._v(" "),s("p",[s("img",{attrs:{src:a(289),alt:"image-20200408024001457"}})]),t._v(" "),s("p",[s("img",{attrs:{src:a(302),alt:"image-20200408030752728"}})]),t._v(" "),s("p",[s("img",{attrs:{src:a(303),alt:"image-20200408030801066"}})])]),t._v(" "),s("li",[s("p",[t._v("build.gradle")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("dependencies {\n    testCompile group: 'junit', name: 'junit', version: '4.12'\n    implementation 'org.springframework.cloud:spring-cloud-starter-eureka'\n}\n")])])])]),t._v(" "),s("li",[s("p",[t._v("application.yml")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server:\n  port: 9090\nspring:\n  application:\n    // 当服务消费者需要调用服务提供者时，即可通过此name进行调用。\n    name: eureka-provider\neureka:\n  client:\n    # 表示eureka client间隔多久去拉取服务注册信息，默认为30秒，对于api-gateway，如果要迅速获取服务注册状态，可以缩小该值.\n    registry-fetch-interval-seconds: 10\n    register-with-eureka: true\n    fetch-registry: true\n    serviceUrl:\n      defaultZone: http://localhost:8000/eureka/\n")])])])]),t._v(" "),s("li",[s("p",[t._v("创建供服务消费者调用的接口")]),t._v(" "),s("p",[s("img",{attrs:{src:a(304),alt:"image-20200408031300013"}})]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[t._v("package")]),t._v(" com"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("microve"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("system"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("controller"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" org"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bind"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GetMapping"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" org"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bind"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RequestMapping"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" org"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("web"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bind"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RestController"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("/**\n * @author : Li Junyi\n * @Remark：\n * @Date 2020-04-05 04:02\n */")]),t._v("\n"),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@RestController")]),t._v("\n"),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"/test"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("TestController")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),t._v("\n    "),s("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" String "),s("span",{attrs:{class:"token function"}},[t._v("getResult")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('"服务提供者被调用"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("创建启动类")]),t._v(" "),s("p",[s("img",{attrs:{src:a(305),alt:"image-20200408030247853"}})]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("package com.microve;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.netflix.eureka.EnableEurekaClient;\n\n/**\n * @author : Li Junyi\n * @Remark：\n * @Date 2020-04-05 03:58\n */\n@SpringBootApplication\n@EnableEurekaClient\npublic class EurekaProviderStarter {\n    public static void main(String[] args) {\n        SpringApplication.run(EurekaProviderStarter.class, args);\n    }\n}\n\n")])])])]),t._v(" "),s("li",[s("p",[t._v("启动服务提供者")]),t._v(" "),s("p",[t._v("启动成功")]),t._v(" "),s("p",[s("img",{attrs:{src:a(306),alt:"image-20200408030922721"}})]),t._v(" "),s("p",[t._v("在Eureka-Server的日志中，可以看到provider注册成功")]),t._v(" "),s("p",[s("img",{attrs:{src:a(307),alt:"image-20200408031030626"}})])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"_5-构建服务消费者"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-构建服务消费者","aria-hidden":"true"}},[this._v("#")]),this._v(" 5. 构建服务消费者")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("ul",[s("li",[s("p",[t._v("创建子项目")]),t._v(" "),s("p",[t._v("使用相同步骤创建子项目: eureka-consumer")]),t._v(" "),s("p",[s("img",{attrs:{src:a(308),alt:"image-20200408031211916"}})])]),t._v(" "),s("li",[s("p",[t._v("build.gradle")]),t._v(" "),s("div",{staticClass:"language-groovy extra-class"},[s("pre",{pre:!0,attrs:{class:"language-groovy"}},[s("code",[t._v("dependencies "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    testCompile group"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'junit'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'junit'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" version"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'4.12'")]),t._v("\n    implementation "),s("span",{attrs:{class:"token string"}},[t._v("'org.springframework.cloud:spring-cloud-starter-eureka'")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("application.yml")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server:\n  port: 9091\nspring:\n  application:\n    name: eureka-consumer\neureka:\n  client:\n    # 表示eureka client间隔多久去拉取服务注册信息，默认为30秒，对于api-gateway，如果要迅速获取服务注册状态，可以缩小该值.\n    registry-fetch-interval-seconds: 10\n    register-with-eureka: true\n    fetch-registry: true\n    serviceUrl:\n      defaultZone: http://localhost:8000/eureka/\n")])])])]),t._v(" "),s("li",[s("p",[t._v("编写接口调用Service Provider")]),t._v(" "),s("p",[s("img",{attrs:{src:a(309),alt:"image-20200408032803657"}}),t._v("\\")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('package com.microve.system.controller;\n\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.cloud.client.ServiceInstance;\nimport org.springframework.cloud.client.loadbalancer.LoadBalancerClient;\nimport org.springframework.core.ParameterizedTypeReference;\nimport org.springframework.http.HttpMethod;\nimport org.springframework.http.ResponseEntity;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RestController;\nimport org.springframework.web.client.RestTemplate;\n\n/**\n * @author : Li Junyi\n * @Remark：\n * @Date 2020-04-05 04:20\n */\n@RestController\n@RequestMapping("/consumer")\npublic class ConsumerController {\n    @Autowired\n    private LoadBalancerClient loadBalancerClient;  //ribbon:负载均衡器\n\n    @GetMapping\n    public String consume(){\n        //选择调用的服务的名称\n        //ServiceInstance:封装了服务的基本信息，如：ip、端口号等\n        ServiceInstance si = loadBalancerClient.choose("eureka-provider");\n        //拼接访问服务的url\n        StringBuffer sb = new StringBuffer();\n\n        // http://localhost:9090/test\n        sb.append("http://").append(si.getHost()).append(":").append(si.getPort()).append("/test");\n\n        //SpringMVC RestTemplate\n        RestTemplate restTemplate = new RestTemplate();\n        ParameterizedTypeReference<String> type = new ParameterizedTypeReference<String>() {\n        };\n\n        //ResponseEntity：封装了返回值信息\n        ResponseEntity<String> entity = restTemplate.exchange(sb.toString(), HttpMethod.GET, null, type);\n        return entity.getBody();\n    }\n}\n')])])])]),t._v(" "),s("li",[s("p",[t._v("创建启动类")]),t._v(" "),s("p",[s("img",{attrs:{src:a(310),alt:"image-20200408033450383"}})]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("package com.microve;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.netflix.eureka.EnableEurekaClient;\n\n/**\n * @author : Li Junyi\n * @Remark：\n * @Date 2020-04-05 04:17\n */\n@SpringBootApplication\n@EnableEurekaClient\npublic class EurekaConsumerStarter {\n    public static void main(String[] args) {\n        SpringApplication.run(EurekaConsumerStarter.class, args);\n    }\n}\n")])])])]),t._v(" "),s("li",[s("p",[t._v("启动服务消费者，并调用服务消费者的接口")]),t._v(" "),s("p",[s("img",{attrs:{src:a(311),alt:"image-20200408033632732"}})]),t._v(" "),s("p",[s("img",{attrs:{src:a(312),alt:"image-20200408033558255"}})]),t._v(" "),s("p",[t._v("成功通过Eureka-Server调用Service-Provider提供的接口。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(313),alt:"image-20200408033642464"}})])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"注意事项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意事项","aria-hidden":"true"}},[this._v("#")]),this._v(" 注意事项")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ol",[n("li",[this._v("需要先启动注册中心，再启动提供者、消费者。如果提供者、消费者正在运行，重启注册中心可能会报错。因为提供者、消费者在与注册中心建立连接后，会通过RESTFUL的方式发送心跳至注册中心。")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"源码地址"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#源码地址","aria-hidden":"true"}},[this._v("#")]),this._v(" 源码地址")])}],e=a(1),r=Object(e.a)({},function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),a("p",[t._v("试想，当我们面临多个服务之间需要互相调用时，最简单的方式就是使用类似于HttpClient或OKHttp等常见的Http/Https请求框架来进行调用。在服务url信息发生改变时，为了尽可能花费较小代价完成服务的更新，我们需要将它放到配置文件中。这样省去了修改源码 → 编译 → 上传这一流程，只需要修改配置文件中的url信息，重启服务即可。")]),t._v(" "),a("p",[t._v("短时间内看来，我们只需要考虑维护极少的服务配置文件和服务，这样似乎没有太大问题。可随着时间推移，我们面对的业务场景越来越复杂，我们不得不根据不同场景，增加服务、或将一个服务拆分成多个，随之而来的是更为繁杂的维护工作。**这时，有一个线上服务横空出世，它就是注册中心。它可以将我们所有服务的url信息、路由信息等进行统一管理，并提供查询API，在某一服务内部需要调用被统一管理的另一个服务时，只需要通过注册中心，就可以获得所有服务的信息。**从此，我们只需要从注册中心拉取服务列表，就能得到最新、最准确的服务信息。这也是我们常说的——服务治理。")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),a("p",[t._v("如果跳过此步骤，IDEA将自动下载某个版本的Gradle，由于有时下载很慢。我们可以将一个稳定的Gradle预先下载到本地，让项目加载我们下载好的Gradle。")]),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),a("p",[t._v("按照与创建Eureka Server相同的步骤创建Eureka Client子项目。不同的是，该模块需要引入作为Eureka-Client的依赖。")]),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),a("p",[t._v("源码已上传github, 如果遇到问题可下载源码查看。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/slowside45/microve",target:"_blank",rel:"noopener noreferrer"}},[t._v("microve"),a("OutboundLink")],1)])])},s,!1,null,null,null);r.options.__file="eureka.md";n.default=r.exports}}]);